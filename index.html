<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="description" content="Explore NASA's Astronomy Picture of the Day, Mars Rover photos, Near Earth Objects, and Space Weather data">
    <meta name="theme-color" content="#0f172a">
    <title>NASA Explorer - Cosmic Archives</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 50%, #581c87 100%);
            min-height: 100vh;
            color: #f8fafc;
        }

        /* Stars Animation */
        @keyframes twinkle {
            0%, 100% { opacity: 0.2; }
            50% { opacity: 1; }
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s ease-in-out infinite;
        }

        /* Calendar Styles */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }

        .day-cell {
            aspect-ratio: 1 / 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            cursor: pointer;
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .day-cell:hover:not(.disabled):not(.empty) {
            transform: translateY(-2px);
            background: rgba(51, 65, 85, 0.9);
            border-color: #3b82f6;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.4);
        }

        .day-cell.active {
            background: rgba(59, 130, 246, 0.3);
            border-color: #60a5fa;
            box-shadow: inset 0 0 10px rgba(59, 130, 246, 0.3);
        }

        .day-cell.disabled {
            opacity: 0.2;
            cursor: not-allowed;
        }

        .day-cell.empty {
            background: transparent;
            border: none;
            cursor: default;
        }

        .media-indicator {
            position: absolute;
            bottom: 4px;
            right: 4px;
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }

        .indicator-image {
            background: #3b82f6;
            box-shadow: 0 0 8px rgba(59, 130, 246, 0.8);
        }

        .indicator-video {
            background: #a855f7;
        }

        /* Glass morphism */
        .glass {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #020617;
        }

        ::-webkit-scrollbar-thumb {
            background: #1e293b;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #334155;
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in-up {
            animation: fadeInUp 0.5s ease-out;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .modal.active {
            display: flex;
        }

        /* Loading */
        .spinner {
            width: 48px;
            height: 48px;
            border: 3px solid rgba(59, 130, 246, 0.3);
            border-top-color: #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Tab active state */
        .tab-active {
            background: #ef4444;
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.5);
        }

        .tab-apod-active {
            background: #3b82f6;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
        }

        /* Mobile optimizations */
        @media (max-width: 640px) {
            .calendar-grid {
                gap: 4px;
            }
            
            .day-cell {
                font-size: 12px;
            }
        }

        /* Better touch interactions */
        button {
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        /* Safe area padding for notched phones */
        @supports (padding: max(0px)) {
            body {
                padding-left: max(0px, env(safe-area-inset-left));
                padding-right: max(0px, env(safe-area-inset-right));
            }
        }
    </style>
</head>
<body class="overflow-x-hidden">
    <!-- Stars Background -->
    <div id="stars-container" class="fixed inset-0 overflow-hidden pointer-events-none"></div>

    <!-- Main Container -->
    <div class="relative z-10">
        <!-- Header -->
        <header class="bg-black bg-opacity-30 backdrop-blur-md border-b border-gray-800">
            <div class="max-w-7xl mx-auto px-4 py-6">
                <div class="flex items-center gap-3 mb-2">
                    <svg class="w-10 h-10 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                    </svg>
                    <h1 class="text-4xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">
                        NASA Explorer
                    </h1>
                </div>
                <p class="text-gray-300 text-sm">Discover the wonders of space through NASA's eyes</p>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="bg-black bg-opacity-20 backdrop-blur-md border-b border-gray-800 sticky top-0 z-20">
            <div class="max-w-7xl mx-auto px-4">
                <div class="flex gap-2 py-3 overflow-x-auto">
                    <button onclick="switchTab('apod')" id="tab-apod" class="tab-apod-active flex items-center gap-2 px-4 md:px-6 py-3 rounded-xl transition-all font-semibold text-white whitespace-nowrap">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        <span class="hidden sm:inline">Astronomy Picture</span>
                        <span class="sm:hidden">APOD</span>
                    </button>
                    <button onclick="switchTab('mars')" id="tab-mars" class="flex items-center gap-2 px-4 md:px-6 py-3 rounded-xl transition-all font-semibold text-gray-300 hover:bg-gray-800 whitespace-nowrap">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                        <span class="hidden sm:inline">Mars Rover</span>
                        <span class="sm:hidden">Mars</span>
                    </button>
                    <button onclick="switchTab('neo')" id="tab-neo" class="flex items-center gap-2 px-4 md:px-6 py-3 rounded-xl transition-all font-semibold text-gray-300 hover:bg-gray-800 whitespace-nowrap">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <span class="hidden sm:inline">Asteroids</span>
                        <span class="sm:hidden">NEO</span>
                    </button>
                    <button onclick="switchTab('space-weather')" id="tab-space-weather" class="flex items-center gap-2 px-4 md:px-6 py-3 rounded-xl transition-all font-semibold text-gray-300 hover:bg-gray-800 whitespace-nowrap">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                        </svg>
                        <span class="hidden sm:inline">Space Weather</span>
                        <span class="sm:hidden">Weather</span>
                    </button>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 py-8">
            <!-- APOD Section -->
            <div id="section-apod" class="grid grid-cols-1 lg:grid-cols-12 gap-6">
                <!-- Calendar Column -->
                <div class="lg:col-span-5">
                    <div class="glass rounded-3xl p-6">
                        <div class="mb-6">
                            <h2 class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-indigo-400">
                                Cosmic Archives
                            </h2>
                            <p class="text-gray-400 text-sm mt-1">Browse NASA's daily discoveries since 1995</p>
                        </div>

                        <!-- Month Navigation -->
                        <div class="flex items-center justify-between mb-8">
                            <button onclick="previousMonth()" class="p-2 hover:bg-gray-800 rounded-lg transition-colors">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                                </svg>
                            </button>
                            <h3 id="current-month-year" class="text-xl font-semibold"></h3>
                            <button onclick="nextMonth()" id="next-month-btn" class="p-2 hover:bg-gray-800 rounded-lg transition-colors">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                                </svg>
                            </button>
                        </div>

                        <!-- Weekday Headers -->
                        <div class="calendar-grid text-center text-xs font-semibold text-gray-500 uppercase mb-4">
                            <div>Sun</div>
                            <div>Mon</div>
                            <div>Tue</div>
                            <div>Wed</div>
                            <div>Thu</div>
                            <div>Fri</div>
                            <div>Sat</div>
                        </div>

                        <!-- Calendar Grid -->
                        <div id="calendar-days" class="calendar-grid mb-6">
                            <!-- Days injected by JS -->
                        </div>

                        <!-- Legend -->
                        <div class="flex gap-4 text-xs text-gray-500 justify-center pt-4 border-t border-gray-800">
                            <div class="flex items-center gap-1.5">
                                <span class="w-2 h-2 rounded-full bg-blue-500 shadow-[0_0_4px_rgba(59,130,246,0.8)]"></span>
                                Image
                            </div>
                            <div class="flex items-center gap-1.5">
                                <span class="w-2 h-2 rounded-full bg-purple-500"></span>
                                Video
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Detail View Column -->
                <div class="lg:col-span-7">
                    <div class="glass rounded-3xl overflow-hidden min-h-[600px] lg:sticky lg:top-8 relative">
                        <!-- Loading Overlay -->
                        <div id="loading-overlay" class="hidden absolute inset-0 z-10 bg-gray-950 bg-opacity-80 flex items-center justify-center flex-col gap-4">
                            <div class="spinner"></div>
                            <p class="text-blue-400 font-medium">Loading...</p>
                        </div>

                        <!-- Placeholder -->
                        <div id="detail-placeholder" class="flex flex-col items-center justify-center p-12 text-center min-h-[600px]">
                            <svg class="w-16 h-16 mb-4 opacity-20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                            <p class="text-gray-500">Select a highlighted day in the calendar to view NASA's cosmic record.</p>
                        </div>

                        <!-- Detail Content -->
                        <div id="detail-content" class="hidden">
                            <!-- Media Stage -->
                            <div id="media-stage" class="w-full bg-black aspect-video flex items-center justify-center">
                                <!-- Media injected here -->
                            </div>

                            <!-- Content -->
                            <div class="p-8 space-y-4">
                                <div class="flex justify-between items-start gap-4 flex-wrap">
                                    <h3 id="detail-title" class="text-3xl font-bold text-white leading-tight flex-1"></h3>
                                    <span id="detail-date" class="shrink-0 text-sm font-mono text-blue-400 bg-blue-400 bg-opacity-10 px-3 py-1 rounded-lg"></span>
                                </div>
                                <p id="detail-explanation" class="text-gray-300 leading-relaxed text-lg"></p>
                                <div id="detail-copyright" class="text-sm text-gray-500 pt-4 border-t border-gray-800"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mars Section -->
            <div id="section-mars" class="hidden">
                <!-- Sol Navigation -->
                <div class="glass rounded-3xl p-4 md:p-6 mb-6">
                    <div class="flex items-center gap-3 mb-4">
                        <svg class="w-6 h-6 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                        <div>
                            <h2 class="text-xl md:text-2xl font-bold text-white">Curiosity Rover</h2>
                            <p class="text-xs md:text-sm text-gray-400">Sol <span id="mars-sol-display">1000</span> ‚Ä¢ <span id="mars-date-display">2015-05-30</span></p>
                        </div>
                    </div>

                    <div class="flex items-center justify-between gap-2">
                        <button onclick="previousSol()" class="flex items-center gap-2 px-3 md:px-4 py-2 bg-gray-800 hover:bg-gray-700 rounded-lg transition-colors text-sm md:text-base">
                            <svg class="w-4 h-4 md:w-5 md:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                            </svg>
                            <span>-10 Sols</span>
                        </button>

                        <div class="flex items-center gap-2 px-3 md:px-4 py-2 bg-red-500 bg-opacity-20 rounded-lg border border-red-500">
                            <span class="text-sm md:text-base font-semibold text-white">Sol <span id="mars-sol-number">1000</span></span>
                        </div>

                        <button onclick="nextSol()" class="flex items-center gap-2 px-3 md:px-4 py-2 bg-gray-800 hover:bg-gray-700 rounded-lg transition-colors text-sm md:text-base">
                            <span>+10 Sols</span>
                            <svg class="w-4 h-4 md:w-5 md:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Mars Photos Grid -->
                <div id="mars-loading" class="hidden flex items-center justify-center h-64">
                    <div class="spinner"></div>
                </div>

                <div id="mars-photos-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 md:gap-4">
                    <!-- Photos injected here -->
                </div>

                <div id="mars-empty" class="hidden text-center text-gray-400 py-12 glass rounded-3xl">
                    <p class="text-base md:text-lg">No photos available for this Sol</p>
                    <p class="text-xs md:text-sm mt-2">Try a different Sol number</p>
                </div>
            </div>

            <!-- NEO Section -->
            <div id="section-neo" class="hidden">
                <div class="glass rounded-3xl p-4 md:p-6 mb-6">
                    <div class="flex items-center justify-between flex-wrap gap-4">
                        <div class="flex items-center gap-3">
                            <svg class="w-6 h-6 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            <div>
                                <h2 class="text-xl md:text-2xl font-bold text-white">Near Earth Asteroids</h2>
                                <p class="text-xs md:text-sm text-gray-400">Today's approaching objects</p>
                            </div>
                        </div>
                        <button onclick="fetchNEO()" class="px-4 py-2 bg-green-500 hover:bg-green-600 rounded-lg transition-colors text-sm font-semibold">
                            Refresh
                        </button>
                    </div>
                </div>

                <div id="neo-loading" class="hidden flex items-center justify-center h-64">
                    <div class="spinner"></div>
                </div>

                <div id="neo-grid" class="grid gap-3 md:gap-4">
                    <!-- NEO data injected here -->
                </div>

                <div id="neo-empty" class="hidden text-center text-gray-400 py-12 glass rounded-3xl">
                    <p class="text-base md:text-lg">No asteroids detected near Earth today</p>
                </div>
            </div>

            <!-- Space Weather Section -->
            <div id="section-space-weather" class="hidden">
                <div class="glass rounded-3xl p-4 md:p-6 mb-6">
                    <div class="flex items-center justify-between flex-wrap gap-4">
                        <div class="flex items-center gap-3">
                            <svg class="w-6 h-6 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                            </svg>
                            <div>
                                <h2 class="text-xl md:text-2xl font-bold text-white">Space Weather</h2>
                                <p class="text-xs md:text-sm text-gray-400">Solar activity and geomagnetic storms</p>
                            </div>
                        </div>
                        <button onclick="fetchSpaceWeather()" class="px-4 py-2 bg-yellow-500 hover:bg-yellow-600 rounded-lg transition-colors text-sm font-semibold text-gray-900">
                            Refresh
                        </button>
                    </div>
                </div>

                <div id="space-weather-loading" class="hidden flex items-center justify-center h-64">
                    <div class="spinner"></div>
                </div>

                <div id="space-weather-content" class="space-y-4">
                    <!-- Space weather data injected here -->
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="bg-black bg-opacity-30 backdrop-blur-md border-t border-gray-800 mt-16">
            <div class="max-w-7xl mx-auto px-4 py-6 text-center text-gray-400 text-sm">
                <p>Data provided by NASA's Open APIs</p>
                <p class="mt-1">üöÄ Exploring the cosmos, one API call at a time</p>
            </div>
        </footer>
    </div>

    <!-- Mars Photo Modal -->
    <div id="photo-modal" class="modal">
        <div class="relative max-w-5xl max-h-full w-full" onclick="event.stopPropagation()">
            <button onclick="closePhotoModal()" class="absolute -top-12 right-0 text-white hover:text-gray-300 transition-colors bg-gray-900 rounded-full p-2">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
            <img id="modal-image" src="" alt="" class="w-full max-h-screen object-contain rounded-lg">
            <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black to-transparent p-4 rounded-b-lg text-white">
                <p id="modal-camera" class="font-semibold"></p>
                <p id="modal-info" class="text-sm text-gray-300"></p>
            </div>
        </div>
    </div>

    <script>
        // NASA API Key
        const API_KEY = '2EGJZOcsMZme56AdBE2bR1L8AvP9c1Da7v3ragQa';
        
        let currentMonth = new Date();
        let monthDataCache = {};
        let selectedDate = null;
        let currentTab = 'apod';
        let marsSol = 1000;

        const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

        // Initialize
        function init() {
            createStars();
            renderCalendar();
        }

        // Create animated stars
        function createStars() {
            const container = document.getElementById('stars-container');
            for (let i = 0; i < 50; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.width = Math.random() * 3 + 1 + 'px';
                star.style.height = star.style.width;
                star.style.top = Math.random() * 100 + '%';
                star.style.left = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 3 + 's';
                star.style.animationDuration = Math.random() * 3 + 2 + 's';
                container.appendChild(star);
            }
        }

        // Tab switching
        function switchTab(tab) {
            currentTab = tab;
            
            // Hide all sections
            document.getElementById('section-apod').style.display = 'none';
            document.getElementById('section-mars').style.display = 'none';
            document.getElementById('section-neo').style.display = 'none';
            document.getElementById('section-space-weather').style.display = 'none';

            // Show selected section
            if (tab === 'apod') {
                document.getElementById('section-apod').style.display = 'grid';
            } else {
                document.getElementById('section-' + tab).style.display = 'block';
            }

            // Update tab buttons - reset all first
            const tabs = ['apod', 'mars', 'neo', 'space-weather'];
            tabs.forEach(t => {
                const btn = document.getElementById('tab-' + t);
                btn.className = 'flex items-center gap-2 px-4 md:px-6 py-3 rounded-xl transition-all font-semibold text-gray-300 hover:bg-gray-800 whitespace-nowrap';
            });

            // Activate current tab
            const activeBtn = document.getElementById('tab-' + tab);
            const colors = {
                'apod': 'tab-apod-active',
                'mars': 'tab-active',
                'neo': 'bg-green-500 shadow-lg shadow-green-500/50',
                'space-weather': 'bg-yellow-500 shadow-lg shadow-yellow-500/50 text-gray-900'
            };
            
            activeBtn.className = `flex items-center gap-2 px-4 md:px-6 py-3 rounded-xl transition-all font-semibold text-white whitespace-nowrap ${colors[tab]}`;

            // Load data for the tab
            if (tab === 'mars') {
                fetchMarsPhotos();
            } else if (tab === 'neo') {
                fetchNEO();
            } else if (tab === 'space-weather') {
                fetchSpaceWeather();
            }
        }

        // Month navigation
        function previousMonth() {
            currentMonth.setMonth(currentMonth.getMonth() - 1);
            selectedDate = null;
            hideDetail();
            renderCalendar();
        }

        function nextMonth() {
            const today = new Date();
            if (currentMonth.getMonth() === today.getMonth() && currentMonth.getFullYear() === today.getFullYear()) {
                return;
            }
            currentMonth.setMonth(currentMonth.getMonth() + 1);
            selectedDate = null;
            hideDetail();
            renderCalendar();
        }

        // Calendar rendering
        async function renderCalendar() {
            const year = currentMonth.getFullYear();
            const month = currentMonth.getMonth();

            document.getElementById('current-month-year').textContent = `${monthNames[month]} ${year}`;

            const calendarDays = document.getElementById('calendar-days');
            calendarDays.innerHTML = '';

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const today = new Date();

            // Disable next button if current month
            const isCurrentMonth = month === today.getMonth() && year === today.getFullYear();
            document.getElementById('next-month-btn').disabled = isCurrentMonth;
            document.getElementById('next-month-btn').style.opacity = isCurrentMonth ? '0.3' : '1';

            // Empty cells
            for (let i = 0; i < firstDay; i++) {
                const empty = document.createElement('div');
                empty.className = 'day-cell empty';
                calendarDays.appendChild(empty);
            }

            // Days
            for (let day = 1; day <= daysInMonth; day++) {
                const cell = document.createElement('div');
                cell.className = 'day-cell';
                cell.textContent = day;

                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const date = new Date(dateStr);

                if (date > today) {
                    cell.classList.add('disabled');
                } else {
                    cell.onclick = () => selectDate(dateStr, cell);
                }

                calendarDays.appendChild(cell);
            }

            // Fetch and highlight month data
            await fetchMonthData();
        }

        // Fetch month data
        async function fetchMonthData() {
            const year = currentMonth.getFullYear();
            const month = currentMonth.getMonth();
            const cacheKey = `${year}-${month}`;

            if (monthDataCache[cacheKey]) {
                highlightDays();
                return;
            }

            try {
                const startDate = `${year}-${String(month + 1).padStart(2, '0')}-01`;
                const today = new Date();
                const lastDay = (year === today.getFullYear() && month === today.getMonth()) 
                    ? today.getDate() 
                    : new Date(year, month + 1, 0).getDate();
                const endDate = `${year}-${String(month + 1).padStart(2, '0')}-${String(lastDay).padStart(2, '0')}`;

                const url = `https://api.nasa.gov/planetary/apod?api_key=${API_KEY}&start_date=${startDate}&end_date=${endDate}`;
                console.log('Fetching:', url);
                
                const response = await fetch(url);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('API Error:', response.status, errorText);
                    
                    if (response.status === 403 || response.status === 429) {
                        alert('NASA API rate limit reached. Please get your free API key at https://api.nasa.gov/ and replace DEMO_KEY in the code.');
                    }
                    return;
                }

                const data = await response.json();
                
                // Handle both single object and array responses
                const entries = Array.isArray(data) ? data : [data];

                monthDataCache[cacheKey] = {};
                entries.forEach(entry => {
                    monthDataCache[cacheKey][entry.date] = entry;
                });

                highlightDays();
            } catch (error) {
                console.error('Error fetching month data:', error);
                alert('Failed to connect to NASA API. Please check your internet connection and API key.');
            }
        }

        // Highlight days with data
        function highlightDays() {
            const year = currentMonth.getFullYear();
            const month = currentMonth.getMonth();
            const cacheKey = `${year}-${month}`;
            const cache = monthDataCache[cacheKey] || {};

            const cells = document.querySelectorAll('.day-cell:not(.empty):not(.disabled)');
            cells.forEach(cell => {
                const day = parseInt(cell.textContent);
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const entry = cache[dateStr];

                if (entry) {
                    const indicator = document.createElement('div');
                    indicator.className = `media-indicator ${entry.media_type === 'video' ? 'indicator-video' : 'indicator-image'}`;
                    cell.appendChild(indicator);
                    cell.title = entry.title;
                }
            });
        }

        // Select date
        async function selectDate(dateStr, element) {
            selectedDate = dateStr;

            // Update active state
            document.querySelectorAll('.day-cell').forEach(c => c.classList.remove('active'));
            element.classList.add('active');

            showLoading();

            try {
                const year = currentMonth.getFullYear();
                const month = currentMonth.getMonth();
                const cacheKey = `${year}-${month}`;

                let data = monthDataCache[cacheKey]?.[dateStr];

                if (!data) {
                    const url = `https://api.nasa.gov/planetary/apod?api_key=${API_KEY}&date=${dateStr}`;
                    console.log('Fetching single date:', url);
                    
                    const response = await fetch(url);
                    
                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error('API Error:', response.status, errorText);
                        
                        if (response.status === 403 || response.status === 429) {
                            alert('NASA API rate limit reached. Please get your free API key at https://api.nasa.gov/');
                        }
                        hideLoading();
                        return;
                    }
                    
                    data = await response.json();
                }

                renderDetail(data);
            } catch (error) {
                console.error('Error fetching date data:', error);
                alert('Failed to load data for this date. Please try again.');
            } finally {
                hideLoading();
            }
        }

        // Show/hide loading
        function showLoading() {
            document.getElementById('loading-overlay').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loading-overlay').classList.add('hidden');
        }

        // Render detail view
        function renderDetail(data) {
            document.getElementById('detail-placeholder').classList.add('hidden');
            document.getElementById('detail-content').classList.remove('hidden');

            document.getElementById('detail-title').textContent = data.title;
            document.getElementById('detail-date').textContent = data.date;
            document.getElementById('detail-explanation').textContent = data.explanation;
            document.getElementById('detail-copyright').textContent = data.copyright ? `¬© ${data.copyright}` : 'Public Domain / NASA';

            const stage = document.getElementById('media-stage');
            stage.innerHTML = '';

            if (data.media_type === 'image') {
                const img = document.createElement('img');
                img.src = data.url;
                img.alt = data.title;
                img.className = 'max-w-full max-h-full object-contain';
                stage.appendChild(img);
            } else {
                const iframe = document.createElement('iframe');
                iframe.src = data.url;
                iframe.className = 'w-full h-full';
                iframe.allowFullscreen = true;
                stage.appendChild(iframe);
            }
        }

        // Hide detail view
        function hideDetail() {
            document.getElementById('detail-placeholder').classList.remove('hidden');
            document.getElementById('detail-content').classList.add('hidden');
        }

        // Mars functions
        function previousSol() {
            if (marsSol > 0) {
                marsSol = Math.max(0, marsSol - 10);
                updateMarsSol();
                fetchMarsPhotos();
            }
        }

        function nextSol() {
            if (marsSol < 4000) {
                marsSol = Math.min(4000, marsSol + 10);
                updateMarsSol();
                fetchMarsPhotos();
            }
        }

        function updateMarsSol() {
            document.getElementById('mars-sol-display').textContent = marsSol;
            document.getElementById('mars-sol-number').textContent = marsSol;
        }

        async function fetchMarsPhotos() {
            document.getElementById('mars-loading').classList.remove('hidden');
            document.getElementById('mars-photos-grid').innerHTML = '';
            document.getElementById('mars-empty').classList.add('hidden');

            try {
                const url = `https://api.nasa.gov/mars-photos/api/v1/rovers/curiosity/photos?sol=${marsSol}&api_key=${API_KEY}`;
                console.log('Fetching Mars photos:', url);
                
                const response = await fetch(url);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('Mars API Error:', response.status, errorText);
                    
                    if (response.status === 403 || response.status === 429) {
                        alert('NASA API rate limit reached. Please get your free API key at https://api.nasa.gov/');
                    }
                    document.getElementById('mars-loading').classList.add('hidden');
                    return;
                }
                
                const data = await response.json();

                if (data.photos && data.photos.length > 0) {
                    document.getElementById('mars-date-display').textContent = data.photos[0].earth_date;
                    renderMarsPhotos(data.photos.slice(0, 12));
                } else {
                    document.getElementById('mars-empty').classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error fetching Mars photos:', error);
                alert('Failed to load Mars photos. Please try again.');
            } finally {
                document.getElementById('mars-loading').classList.add('hidden');
            }
        }

        function renderMarsPhotos(photos) {
            const grid = document.getElementById('mars-photos-grid');
            grid.innerHTML = '';

            photos.forEach((photo, index) => {
                const div = document.createElement('div');
                div.className = 'relative group cursor-pointer rounded-xl overflow-hidden shadow-lg transform transition-all duration-300 hover:scale-105 hover:shadow-2xl bg-gray-900 fade-in-up';
                div.style.animationDelay = `${index * 0.1}s`;
                div.onclick = () => openPhotoModal(photo);

                div.innerHTML = `
                    <img src="${photo.img_src}" alt="${photo.camera.name}" class="w-full h-48 object-cover">
                    <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity flex items-end p-3">
                        <div class="text-white text-sm">
                            <p class="font-semibold">${photo.camera.name}</p>
                            <p class="text-xs text-gray-300">${photo.earth_date}</p>
                        </div>
                    </div>
                `;

                grid.appendChild(div);
            });
        }

        function openPhotoModal(photo) {
            document.getElementById('modal-image').src = photo.img_src;
            document.getElementById('modal-camera').textContent = photo.camera.full_name;
            document.getElementById('modal-info').textContent = `Sol ${photo.sol} ‚Ä¢ ${photo.earth_date}`;
            document.getElementById('photo-modal').classList.add('active');
        }

        function closePhotoModal() {
            document.getElementById('photo-modal').classList.remove('active');
        }

        // Close modal on click outside
        document.getElementById('photo-modal').onclick = closePhotoModal;

        // NEO Functions
        async function fetchNEO() {
            document.getElementById('neo-loading').classList.remove('hidden');
            document.getElementById('neo-grid').innerHTML = '';
            document.getElementById('neo-empty').classList.add('hidden');

            try {
                const today = new Date().toISOString().split('T')[0];
                const url = `https://api.nasa.gov/neo/rest/v1/feed?start_date=${today}&end_date=${today}&api_key=${API_KEY}`;
                console.log('Fetching NEO:', url);
                
                const response = await fetch(url);
                
                if (!response.ok) {
                    console.error('NEO API Error:', response.status);
                    document.getElementById('neo-loading').classList.add('hidden');
                    document.getElementById('neo-empty').classList.remove('hidden');
                    return;
                }
                
                const data = await response.json();
                const neos = Object.values(data.near_earth_objects)[0] || [];

                if (neos.length > 0) {
                    renderNEO(neos);
                } else {
                    document.getElementById('neo-empty').classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error fetching NEO:', error);
                document.getElementById('neo-empty').classList.remove('hidden');
            } finally {
                document.getElementById('neo-loading').classList.add('hidden');
            }
        }

        function renderNEO(neos) {
            const grid = document.getElementById('neo-grid');
            grid.innerHTML = '';

            neos.slice(0, 10).forEach((neo, index) => {
                const div = document.createElement('div');
                div.className = 'glass rounded-xl p-4 md:p-5 hover:border-green-500 transition-all border border-gray-700 fade-in-up';
                div.style.animationDelay = `${index * 0.1}s`;

                const diameter = neo.estimated_diameter.meters.estimated_diameter_max.toFixed(0);
                const velocity = parseFloat(neo.close_approach_data[0].relative_velocity.kilometers_per_hour).toFixed(0);
                const distance = parseFloat(neo.close_approach_data[0].miss_distance.kilometers).toFixed(0);
                const date = new Date(neo.close_approach_data[0].close_approach_date).toLocaleDateString();
                const isHazardous = neo.is_potentially_hazardous_asteroid;

                div.innerHTML = `
                    <div class="flex items-start justify-between mb-3 gap-2">
                        <div class="flex-1 min-w-0">
                            <h3 class="text-base md:text-lg font-bold text-white mb-1 truncate">${neo.name}</h3>
                            <div class="flex flex-wrap items-center gap-2 text-xs md:text-sm text-gray-400">
                                ${isHazardous ? '<span class="px-2 py-1 bg-red-500 bg-opacity-20 text-red-400 rounded text-xs whitespace-nowrap">‚ö†Ô∏è Hazardous</span>' : ''}
                                <span class="text-gray-500">ID: ${neo.id}</span>
                            </div>
                        </div>
                        <svg class="w-4 h-4 md:w-5 md:h-5 text-yellow-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                        </svg>
                    </div>

                    <div class="grid grid-cols-2 gap-3 text-xs md:text-sm">
                        <div>
                            <p class="text-gray-400">Diameter</p>
                            <p class="text-white font-semibold">${diameter} m</p>
                        </div>
                        <div>
                            <p class="text-gray-400">Velocity</p>
                            <p class="text-white font-semibold">${velocity.toLocaleString()} km/h</p>
                        </div>
                        <div>
                            <p class="text-gray-400">Miss Distance</p>
                            <p class="text-white font-semibold">${distance.toLocaleString()} km</p>
                        </div>
                        <div>
                            <p class="text-gray-400">Close Approach</p>
                            <p class="text-white font-semibold">${date}</p>
                        </div>
                    </div>
                `;

                grid.appendChild(div);
            });
        }

        // Space Weather Functions
        async function fetchSpaceWeather() {
            document.getElementById('space-weather-loading').classList.remove('hidden');
            document.getElementById('space-weather-content').innerHTML = '';

            try {
                // Fetch DONKI notifications (solar flares, CME, geomagnetic storms)
                const endDate = new Date().toISOString().split('T')[0];
                const startDate = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
                
                const url = `https://api.nasa.gov/DONKI/notifications?startDate=${startDate}&endDate=${endDate}&type=all&api_key=${API_KEY}`;
                console.log('Fetching Space Weather:', url);
                
                const response = await fetch(url);
                
                if (!response.ok) {
                    console.error('Space Weather API Error:', response.status);
                    renderSpaceWeatherError();
                    return;
                }
                
                const data = await response.json();
                renderSpaceWeather(data);
            } catch (error) {
                console.error('Error fetching space weather:', error);
                renderSpaceWeatherError();
            } finally {
                document.getElementById('space-weather-loading').classList.add('hidden');
            }
        }

        function renderSpaceWeather(notifications) {
            const content = document.getElementById('space-weather-content');
            content.innerHTML = '';

            if (!notifications || notifications.length === 0) {
                content.innerHTML = `
                    <div class="glass rounded-xl p-8 text-center text-gray-400">
                        <svg class="w-16 h-16 mx-auto mb-4 opacity-20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <p class="text-base md:text-lg">All Clear! No significant space weather events in the past 7 days.</p>
                    </div>
                `;
                return;
            }

            // Group by type
            const grouped = {};
            notifications.forEach(n => {
                const type = n.messageType || 'Other';
                if (!grouped[type]) grouped[type] = [];
                grouped[type].push(n);
            });

            Object.keys(grouped).forEach(type => {
                const events = grouped[type];
                const typeDiv = document.createElement('div');
                typeDiv.className = 'glass rounded-xl p-4 md:p-6 mb-4';

                const typeColors = {
                    'CME': 'text-orange-400',
                    'GST': 'text-red-400',
                    'FLR': 'text-yellow-400',
                    'SEP': 'text-purple-400',
                    'MPC': 'text-blue-400',
                    'RBE': 'text-green-400'
                };

                const typeNames = {
                    'CME': '‚òÑÔ∏è Coronal Mass Ejection',
                    'GST': 'üåç Geomagnetic Storm',
                    'FLR': '‚òÄÔ∏è Solar Flare',
                    'SEP': '‚ö° Solar Energetic Particle',
                    'MPC': 'üõ∞Ô∏è Magnetopause Crossing',
                    'RBE': 'üî¥ Radiation Belt Enhancement'
                };

                typeDiv.innerHTML = `
                    <h3 class="text-lg md:text-xl font-bold mb-4 ${typeColors[type] || 'text-white'}">
                        ${typeNames[type] || type} (${events.length})
                    </h3>
                    <div class="space-y-3">
                        ${events.slice(0, 3).map(event => `
                            <div class="bg-gray-900 bg-opacity-50 rounded-lg p-3 md:p-4 border border-gray-700">
                                <div class="flex justify-between items-start gap-2 mb-2">
                                    <p class="text-xs md:text-sm text-gray-400">${new Date(event.messageIssueTime).toLocaleString()}</p>
                                </div>
                                <p class="text-xs md:text-sm text-gray-300">${event.messageBody ? event.messageBody.substring(0, 200) + '...' : 'Space weather event detected.'}</p>
                            </div>
                        `).join('')}
                    </div>
                `;

                content.appendChild(typeDiv);
            });
        }

        function renderSpaceWeatherError() {
            const content = document.getElementById('space-weather-content');
            content.innerHTML = `
                <div class="glass rounded-xl p-8 text-center text-gray-400">
                    <svg class="w-16 h-16 mx-auto mb-4 opacity-20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    <p class="text-base md:text-lg">Unable to load space weather data at this time.</p>
                    <button onclick="fetchSpaceWeather()" class="mt-4 px-4 py-2 bg-yellow-500 hover:bg-yellow-600 rounded-lg transition-colors text-sm font-semibold text-gray-900">
                        Try Again
                    </button>
                </div>
            `;
        }

        // Initialize on load
        init();
    </script>
</body>
                                </html>
